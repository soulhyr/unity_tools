using UnityEngine;
#if UNITY_EDITOR
using UnityEditor;
#endif

public enum GizmoDrawArrowType
{
    Default,
    Thin,
    Double,
    Triple,
    Solid,
    Fat,
    ThreeD,
}

public static class GizmosExtensions
{
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸŸ¦ 3D ê´€ë ¨ ê¸°ì¦ˆëª¨
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    public static class Gizmos3D
    {
        /// <summary>
        /// 3D Wire Arc
        /// </summary>
        /// <param name="position">í˜¸(arc)ë¥¼ ê·¸ë¦´ ì¤‘ì‹¬ ìœ„ì¹˜ì…ë‹ˆë‹¤. ì´ ì ì—ì„œë¶€í„° ë°˜ì§€ë¦„ë§Œí¼ ë–¨ì–´ì§„ ê³³ì— í˜¸ê°€ ê·¸ë ¤ì§‘ë‹ˆë‹¤.</param>
        /// <param name="dir">í˜¸ê°€ í–¥í•˜ëŠ” ê¸°ì¤€ ë°©í–¥ì…ë‹ˆë‹¤. í˜¸ê°€ ì´ ë°©í–¥ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì¢Œìš°ë¡œ í¼ì§‘ë‹ˆë‹¤. (ì¦‰, í˜¸ì˜ "ì¤‘ì•™ ë°©í–¥")</param>
        /// <param name="anglesRange">í˜¸ì˜ ì´ ê°ë„ ë²”ìœ„ì…ë‹ˆë‹¤. ì˜ˆ: 90f â†’ ê¸°ì¤€ ë°©í–¥ì—ì„œ ì¢Œìš°ë¡œ 45ë„ì”© í¼ì³ì§„ í˜¸</param>
        /// <param name="radius">í˜¸ì˜ ë°˜ì§€ë¦„ì…ë‹ˆë‹¤. ì¤‘ì‹¬ ìœ„ì¹˜ì—ì„œ ì„ ì„ ì–¼ë§ˆë‚˜ ë©€ë¦¬ ê·¸ë¦´ì§€ ê²°ì •í•©ë‹ˆë‹¤.</param>
        /// <param name="color">í˜¸ì™€ ì¤‘ì‹¬ì„ ì˜ ìƒ‰ìƒì…ë‹ˆë‹¤. Gizmos.colorì— ì‚¬ìš©ë©ë‹ˆë‹¤.</param>
        /// <param name="steps">í˜¸ë¥¼ ëª‡ ê°œì˜ ì‘ì€ ì„ ë¶„ìœ¼ë¡œ ë‚˜ëˆŒì§€ ê²°ì •í•©ë‹ˆë‹¤. ê°’ì´ í´ìˆ˜ë¡ ë¶€ë“œëŸ¬ìš´ ê³¡ì„ ì²˜ëŸ¼ ë³´ì´ê³ , ì‘ìœ¼ë©´ ê°ì ¸ ë³´ì…ë‹ˆë‹¤.</param>
        public static void DrawWireArc(Vector3 position, Vector3 dir, float anglesRange, float radius, Color color, int steps = 20)
        {
            Gizmos.color = color;
            if (steps < 1 || radius <= 0f) return;

            float srcAngle = Mathf.Atan2(dir.z, dir.x) * Mathf.Rad2Deg;
            float stepAngle = anglesRange / steps;
            Vector3 center = position;
            float angle = srcAngle - anglesRange * 0.5f;

            Vector3 prev = center + new Vector3(radius * Mathf.Cos(angle * Mathf.Deg2Rad), 0f, radius * Mathf.Sin(angle * Mathf.Deg2Rad));
            for (int i = 1; i <= steps; i++)
            {
                angle += stepAngle;
                Vector3 curr = center + new Vector3(radius * Mathf.Cos(angle * Mathf.Deg2Rad), 0f, radius * Mathf.Sin(angle * Mathf.Deg2Rad));
                Gizmos.DrawLine(prev, curr);
                prev = curr;
            }

            float leftAngle = srcAngle - anglesRange * 0.5f;
            float rightAngle = srcAngle + anglesRange * 0.5f;
            Vector3 left = center + new Vector3(radius * Mathf.Cos(leftAngle * Mathf.Deg2Rad), 0f, radius * Mathf.Sin(leftAngle * Mathf.Deg2Rad));
            Vector3 right = center + new Vector3(radius * Mathf.Cos(rightAngle * Mathf.Deg2Rad), 0f, radius * Mathf.Sin(rightAngle * Mathf.Deg2Rad));
            Gizmos.DrawLine(center, left);
            Gizmos.DrawLine(center, right);
        }

        /// <summary>
        /// 3D Arrow - Gizmos
        /// </summary>
        /// <param name="pos">í™”ì‚´í‘œ ì‹œì‘ ìœ„ì¹˜</param>
        /// <param name="dir">í™”ì‚´í‘œê°€ í–¥í•˜ëŠ” ë°©í–¥ê³¼ ê¸¸ì´</param>
        /// <param name="color">í™”ì‚´í‘œ ìƒ‰ìƒ</param>
        /// <param name="headLength">í™”ì‚´ì´‰ì˜ ê¸¸ì´</param>
        /// <param name="headAngle">í™”ì‚´ì´‰ì˜ ê°ë„ (ì¤‘ì‹¬ì„ ê³¼ í™”ì‚´ì´‰ ì„  ì‚¬ì´ ê°ë„)</param>
        public static void DrawArrow(Vector3 pos, Vector3 dir, Color color, float headLength = 0.2f, float headAngle = 20f)
        {
            Gizmos.color = color;
            Gizmos.DrawRay(pos, dir);

            Vector3 right = Quaternion.LookRotation(dir) * Quaternion.Euler(0, 180 + headAngle, 0) * Vector3.forward;
            Vector3 left = Quaternion.LookRotation(dir) * Quaternion.Euler(0, 180 - headAngle, 0) * Vector3.forward;

            Gizmos.DrawRay(pos + dir, right * headLength);
            Gizmos.DrawRay(pos + dir, left * headLength);
        }

        /// <summary>
        /// 3D Arrow - Debug
        /// </summary>
        /// <param name="pos">í™”ì‚´í‘œ ì‹œì‘ ìœ„ì¹˜</param>
        /// <param name="dir">í™”ì‚´í‘œ ë°©í–¥ ë° ê¸¸ì´</param>
        /// <param name="color">í™”ì‚´í‘œ ìƒ‰ìƒ</param>
        /// <param name="duration">ì„ ì´ ì”¬ì— ë‚¨ì•„ìˆëŠ” ì‹œê°„ (ì´ˆ)</param>
        /// <param name="type">í™”ì‚´í‘œ ì¢…ë¥˜ (Default, Triple ë“±)</param>
        /// <param name="headLength">í™”ì‚´ì´‰ ê¸¸ì´</param>
        /// <param name="headAngle">í™”ì‚´ì´‰ ê°ë„</param>
        public static void DrawArrowDebug(Vector3 pos, Vector3 dir, Color color, float duration = 0.5f, GizmoDrawArrowType type = GizmoDrawArrowType.Default, float headLength = 0.2f, float headAngle = 30f)
        {
            if (dir == Vector3.zero) return;

            duration /= Time.timeScale;

            Vector3 forward = dir.normalized;

            // ì”¬ ë·° ì¹´ë©”ë¼ ê¸°ì¤€ ë°©í–¥ (Scene ë·°ê°€ 2D ëª¨ë“œì—¬ë„ ì¹´ë©”ë¼ ë°©í–¥ í™•ë³´)
#if UNITY_EDITOR
            Vector3 camForward = SceneView.lastActiveSceneView != null
                ? SceneView.lastActiveSceneView.camera.transform.forward
                : Vector3.forward;
#else
            Vector3 camForward = Vector3.forward;
#endif

            // í™”ì‚´ì´‰ì„ ì¹´ë©”ë¼ ê¸°ì¤€ìœ¼ë¡œ ì•½ê°„ ë¹„í‹€ê¸°
            Vector3 right = Quaternion.LookRotation(forward, camForward) * Quaternion.Euler(0, 180 + headAngle, 0) * Vector3.forward;
            Vector3 left = Quaternion.LookRotation(forward, camForward) * Quaternion.Euler(0, 180 - headAngle, 0) * Vector3.forward;

            // í™”ì‚´ì´‰
            Debug.DrawRay(pos + dir, right * headLength, color, duration);
            Debug.DrawRay(pos + dir, left * headLength, color, duration);

            // í™”ì‚´ ëª¸í†µ
            switch (type)
            {
                case GizmoDrawArrowType.Default:
                    Debug.DrawRay(pos, dir, color, duration);
                    break;

                case GizmoDrawArrowType.Triple:
                    float width = 0.01f;
                    Vector3 directlyRight = Quaternion.LookRotation(forward) * Quaternion.Euler(0, 270, 0) * Vector3.forward;
                    Vector3 directlyLeft  = Quaternion.LookRotation(forward) * Quaternion.Euler(0, 90, 0) * Vector3.forward;

                    Debug.DrawRay(pos, dir, color, duration);
                    Debug.DrawRay(pos + directlyRight * width, dir * (1 - width), color, duration);
                    Debug.DrawRay(pos + directlyLeft  * width, dir * (1 - width), color, duration);
                    break;
            }
        }

        public static void RandomStar(Vector3 center, Color color, int rays = 2, float headLength = 0.1f, float headAngle = 30f)
        {
            if (center == Vector3.zero) return;

            for (int i = 0; i < rays; i++)
            {
                Vector3 randomDir = Random.onUnitSphere;
                Gizmos3D.DrawArrow(center, randomDir, color, headLength, headAngle);
            }
        }

        public static void ComparePositions(Transform t1, Transform t2, Color color, float duration = 0.5f, GizmoDrawArrowType type = GizmoDrawArrowType.Default)
        {
            Vector3 dir = t2.position - t1.position;
            Gizmos3D.DrawArrowDebug(t1.position, dir, color, duration, type);
        }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸŸ© 2D ê´€ë ¨ ê¸°ì¦ˆëª¨
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    public static class Gizmos2D
    {
        /// <summary>
        /// 2D Wire Arc
        /// </summary>
        /// <param name="position">í˜¸(arc)ë¥¼ ê·¸ë¦´ ì¤‘ì‹¬ ìœ„ì¹˜ì…ë‹ˆë‹¤. ì´ ì ì—ì„œë¶€í„° ë°˜ì§€ë¦„ë§Œí¼ ë–¨ì–´ì§„ ê³³ì— í˜¸ê°€ ê·¸ë ¤ì§‘ë‹ˆë‹¤.</param>
        /// <param name="dir">í˜¸ê°€ í–¥í•˜ëŠ” ê¸°ì¤€ ë°©í–¥ì…ë‹ˆë‹¤. í˜¸ê°€ ì´ ë°©í–¥ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì¢Œìš°ë¡œ í¼ì§‘ë‹ˆë‹¤. (ì¦‰, í˜¸ì˜ "ì¤‘ì•™ ë°©í–¥")</param>
        /// <param name="anglesRange">í˜¸ì˜ ì´ ê°ë„ ë²”ìœ„ì…ë‹ˆë‹¤. ì˜ˆ: 90f â†’ ê¸°ì¤€ ë°©í–¥ì—ì„œ ì¢Œìš°ë¡œ 45ë„ì”© í¼ì³ì§„ í˜¸</param>
        /// <param name="radius">í˜¸ì˜ ë°˜ì§€ë¦„ì…ë‹ˆë‹¤. ì¤‘ì‹¬ ìœ„ì¹˜ì—ì„œ ì„ ì„ ì–¼ë§ˆë‚˜ ë©€ë¦¬ ê·¸ë¦´ì§€ ê²°ì •í•©ë‹ˆë‹¤.</param>
        /// <param name="color">í˜¸ì™€ ì¤‘ì‹¬ì„ ì˜ ìƒ‰ìƒì…ë‹ˆë‹¤. Gizmos.colorì— ì‚¬ìš©ë©ë‹ˆë‹¤.</param>
        /// <param name="steps">í˜¸ë¥¼ ëª‡ ê°œì˜ ì‘ì€ ì„ ë¶„ìœ¼ë¡œ ë‚˜ëˆŒì§€ ê²°ì •í•©ë‹ˆë‹¤. ê°’ì´ í´ìˆ˜ë¡ ë¶€ë“œëŸ¬ìš´ ê³¡ì„ ì²˜ëŸ¼ ë³´ì´ê³ , ì‘ìœ¼ë©´ ê°ì ¸ ë³´ì…ë‹ˆë‹¤.</param>
        public static void DrawWireArc(Vector2 position, Vector2 dir, float anglesRange, float radius, Color color, int steps = 20)
        {
            Gizmos.color = color;
            if (steps < 1 || radius <= 0f) return;

            float srcAngle = Mathf.Atan2(dir.y, dir.x) * Mathf.Rad2Deg;
            float stepAngle = anglesRange / steps;
            Vector3 center = new Vector3(position.x, position.y, 0f);
            float angle = srcAngle - anglesRange * 0.5f;

            Vector3 prev = center + new Vector3(radius * Mathf.Cos(angle * Mathf.Deg2Rad), radius * Mathf.Sin(angle * Mathf.Deg2Rad), 0f);
            for (int i = 1; i <= steps; i++)
            {
                angle += stepAngle;
                Vector3 curr = center + new Vector3(radius * Mathf.Cos(angle * Mathf.Deg2Rad), radius * Mathf.Sin(angle * Mathf.Deg2Rad), 0f);
                Gizmos.DrawLine(prev, curr);
                prev = curr;
            }

            float leftAngle = srcAngle - anglesRange * 0.5f;
            float rightAngle = srcAngle + anglesRange * 0.5f;
            Vector3 left = center + new Vector3(radius * Mathf.Cos(leftAngle * Mathf.Deg2Rad), radius * Mathf.Sin(leftAngle * Mathf.Deg2Rad), 0f);
            Vector3 right = center + new Vector3(radius * Mathf.Cos(rightAngle * Mathf.Deg2Rad), radius * Mathf.Sin(rightAngle * Mathf.Deg2Rad), 0f);
            Gizmos.DrawLine(center, left);
            Gizmos.DrawLine(center, right);
        }

        /// <summary>
        /// 2D Arrow - Gizmos
        /// </summary>
        /// <param name="pos">í™”ì‚´í‘œ ì‹œì‘ ìœ„ì¹˜</param>
        /// <param name="dir">í™”ì‚´í‘œê°€ í–¥í•˜ëŠ” ë°©í–¥ê³¼ ê¸¸ì´</param>
        /// <param name="color">í™”ì‚´í‘œ ìƒ‰ìƒ</param>
        /// <param name="headLength">í™”ì‚´ì´‰ì˜ ê¸¸ì´</param>
        /// <param name="headAngle">í™”ì‚´ì´‰ì˜ ê°ë„ (ì¤‘ì‹¬ì„ ê³¼ í™”ì‚´ì´‰ ì„  ì‚¬ì´ ê°ë„)</param>
        public static void DrawArrow(Vector2 pos, Vector2 dir, Color color, float headLength = 0.2f, float headAngle = 20f)
        {
            Gizmos.color = color;
            Vector3 position = new Vector3(pos.x, pos.y, 0f);
            Vector3 direction = new Vector3(dir.x, dir.y, 0f);
            Gizmos.DrawLine(position, position + direction);

            Vector2 dirNorm = dir.normalized;
            float angleRad = Mathf.Deg2Rad * headAngle;

            Vector3 right = new Vector3(
                Mathf.Cos(Mathf.Atan2(dirNorm.y, dirNorm.x) + Mathf.PI - angleRad),
                Mathf.Sin(Mathf.Atan2(dirNorm.y, dirNorm.x) + Mathf.PI - angleRad),
                0f
            ) * headLength;

            Vector3 left = new Vector3(
                Mathf.Cos(Mathf.Atan2(dirNorm.y, dirNorm.x) + Mathf.PI + angleRad),
                Mathf.Sin(Mathf.Atan2(dirNorm.y, dirNorm.x) + Mathf.PI + angleRad),
                0f
            ) * headLength;

            Gizmos.DrawLine(position + direction, position + direction + right);
            Gizmos.DrawLine(position + direction, position + direction + left);
        }

        /// <summary>
        /// 2D Arrow - Debug
        /// </summary>
        /// <param name="pos">í™”ì‚´í‘œ ì‹œì‘ ìœ„ì¹˜</param>
        /// <param name="dir">í™”ì‚´í‘œ ë°©í–¥ ë° ê¸¸ì´</param>
        /// <param name="color">í™”ì‚´í‘œ ìƒ‰ìƒ</param>
        /// <param name="duration">ì„ ì´ ì”¬ì— ë‚¨ì•„ìˆëŠ” ì‹œê°„ (ì´ˆ)</param>
        /// <param name="type">í™”ì‚´í‘œ ì¢…ë¥˜ (Default, Triple ë“±)</param>
        /// <param name="headLength">í™”ì‚´ì´‰ ê¸¸ì´</param>
        /// <param name="headAngle">í™”ì‚´ì´‰ ê°ë„</param>
        public static void DrawArrowDebug(Vector2 pos, Vector2 dir, Color color, float duration = 0.5f, float headLength = 0.2f, float headAngle = 20f)
        {
            Color actualColor = color;
            duration /= Time.timeScale;

            Vector3 position = new Vector3(pos.x, pos.y, 0f);
            Vector3 direction = new Vector3(dir.x, dir.y, 0f);
            Debug.DrawLine(position, position + direction, actualColor, duration);

            Vector2 dirNorm = dir.normalized;
            float angleRad = Mathf.Deg2Rad * headAngle;

            Vector3 right = new Vector3(
                Mathf.Cos(Mathf.Atan2(dirNorm.y, dirNorm.x) + Mathf.PI - angleRad),
                Mathf.Sin(Mathf.Atan2(dirNorm.y, dirNorm.x) + Mathf.PI - angleRad),
                0f
            ) * headLength;

            Vector3 left = new Vector3(
                Mathf.Cos(Mathf.Atan2(dirNorm.y, dirNorm.x) + Mathf.PI + angleRad),
                Mathf.Sin(Mathf.Atan2(dirNorm.y, dirNorm.x) + Mathf.PI + angleRad),
                0f
            ) * headLength;

            Debug.DrawLine(position + direction, position + direction + right, actualColor, duration);
            Debug.DrawLine(position + direction, position + direction + left, actualColor, duration);
        }
        
        public static void RandomStar(Vector2 center, Color color, int rays = 2, float headLength = 0.1f, float headAngle = 30f)
        {
            if (center == Vector2.zero) return;

            for (int i = 0; i < rays; i++)
            {
                Vector2 randomDir = Random.insideUnitCircle.normalized;
                Gizmos2D.DrawArrow(center, randomDir, color, headLength, headAngle);
            }
        }

        public static void ComparePositions(Transform t1, Transform t2, Color color, float duration = 0.5f)
        {
            Vector2 dir = (Vector2)(t2.position - t1.position);
            Gizmos2D.DrawArrowDebug(t1.position, dir, color, duration);
        }
    }
}
